# 01.内核模块信息

## 1. 检查内核参数

- `grep -v '^#' /etc/systcl.conf`


- `modinfo hello.ko` 显示模块信息
- `insmod hello.ko` 加载模块
- `dmesg` 内核的buffer信息
- `lsmod`
- `rmmod` 卸载模块

> `modprobe -a/-r` 安装/删除

`modprobe`会检查内核的依赖关系,在 **/lib/modules/<内核版本>/modules.dep** 中, 并加载该模块.

## sysctl

> 次工具所有更改为临时更改，重启失效, 如需永久更改, 需修改`/etc/sysctl.conf`

```shell
cp /etc/sysctl.conf{,.bac}
sysctl -a #全部模块
sysctl -p # 应用配置文件参数
sysctl -w # 应用一条配置
```

### 举例1 (forbid ping)

```shell
# 方法1
cat /proc/sys/net/ipv4/icmp_echo_ignore_all        # 查看icmp配置
echo 1 > /proc/sys/net/ipv4/icmp_echo_ignore_all

# 方法2
echo "net.ipv4.icmp_echo_ignore_all = 1" >> /etc/sysctl.conf
sysctl -p
```

### 举例2 (打开ip转发功能. 中间人攻击)
```shell
echo "net.ipv4.ip_forward = 1" >> /etc/sysctl.conf
sysctl -p
```

### 内核加固

![2022-4-22 1-37-25](2022-4-22%201-37-25.png)

## 各种文件

- `/proc/kallsyms` 内核中所有变量与函数名称

```ruby
grep -m 10 NETFILTER /boot/config-4.18.0-193.el8.x86_64
```

- `/etc/sysctl.conf` 内核控制
- `/proc/sys/` 各种内核

> 各种命令
> 1.`depmod`:更新模块依赖链

---