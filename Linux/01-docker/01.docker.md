# docker

**tag:** #linux #linux/docker

`vi /etc/docker/daemon.json`

## 安装

> 以[docker官方为准](https://docs.docker.com/engine/install/)

```shell
yum install yum-utils device-mapper-persistent-data lvm2
yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
yum install docker-ce docker-ce-cli containerd.io
```

## 更改路径

```shell
mv /var/lib/docker/* /home/docker
cp /var/lib/docker/* /home/docker
mount --bind /home/docker /var/lib/docker
```


## docker远程访问端口

对于`openrc`
![开启docker远程访问管理](./../00-发行版本操作/Alpine.md#开启docker远程访问管理)
## 开机启动

```shell
vi /etc/rc.d/init.d/mountdocker

#!/bin/sh
#chkconfig: - 85 15
#description: mount docker store
mount --bind /home/docker /var/lib/docker
```

### 设置为任务

```shell
chkconfig --add /etc/init.d/mountdocker
chkconfig mountdocker on
service mountdocker start
```

## docker更新

```shell
docker container update --restart=always 容器名称
```

## 创建持续可用的镜像

```bash
docker run -d -p 9000:9000 \
--restart=always \
-v /var/run/docker.sock:/var/run/docker.sock \
--name prtainer-ce \
portainer/portainer



docker run -itd \
--name alpine-go \
--restart=always \
-p 18500-18530:18500-18530 \
-v /opt/docker-u/:/opt/docker-u/ \
--entrypoint "/opt/docker-u/star.sh" \
docker.io/alpine 

-i 表示 interactive 可交互的，变即可以从标准输入与容器交互。
-t 表示给容器分配一个虚拟终端。
-d 这个参数表示的是在后台运行，即 –deamon。
```

```bash
#!/bin/sh
# apk add  openssh-server
# ssh-keygen -A


/usr/sbin/sshd -p 18500
echo '000' >> /test.log
# exit 0

while true
do
  sleep 1000
done
```