# 09-各种代理

#linux 

## http代理: squid

```ssh
apk add squid mini_httpd
vim /etc/squid/squid.conf
```

```conf
# Example rule allowing access from your local networks.
# Adapt to list your (internal) IP networks from where browsing
# should be allowed
acl localnet src 0.0.0.1-0.255.255.255  # RFC 1122 "this" network (LAN)
# acl localnet src 10.0.0.0/8           # RFC 1918 local private network (LAN)
# acl localnet src 100.64.0.0/10          # RFC 6598 shared address space (CGN)
# acl localnet src 169.254.0.0/16         # RFC 3927 link-local (directly plugged) machines
# acl localnet src 172.16.0.0/12                # RFC 1918 local private network (LAN)
# acl localnet src 192.168.0.0/16               # RFC 1918 local private network (LAN)
# acl localnet src fc00::/7               # RFC 4193 local private network range
# acl localnet src fe80::/10              # RFC 4291 link-local (directly plugged) machines
# acl localnet src 192.168.56.0/24              # RFC 1918 local private network (LAN)



acl SSL_ports port 443
acl Safe_ports port 80          # http
acl Safe_ports port 21          # ftp
acl Safe_ports port 443         # https
acl Safe_ports port 70          # gopher
acl Safe_ports port 210         # wais
acl Safe_ports port 1025-65535  # unregistered ports
acl Safe_ports port 280         # http-mgmt
acl Safe_ports port 488         # gss-http
acl Safe_ports port 591         # filemaker
acl Safe_ports port 777         # multiling http

# acl test src 10.0.2.2
# http_access allow test

auth_param basic program /usr/lib/squid/basic_ncsa_auth /env/mini_passwd
auth_param basic realm Squid proxy-caching web server
auth_param basic children 5
auth_param basic credentialsttl 2 hours
acl authenticated proxy_auth REQUIRED
http_access allow authenticated
                            
# And finally deny all other access to this proxy
http_access deny all
```

## socks5代理:Dante

- socksmethod一般为username（系统用户登录） ，none（匿名登录）
- 使用username时，务必创建不能登录系统的账户通过命令`useradd`添加用户，`passwd`设置密码。权限可以为`/bin/false是最严格的禁止login选项，一切服务都不能用`与`/sbin/nologin只是不允许系统login，可以使用其他ftp等服务`

```shell
adduser --no-create-home --shell /sbin/nologin liujia2
apk add dante-server
cat /etc/sockd.conf
sockd -f conf -p pid -D
```

```conf
## general configuration (taken from FAQ; <>)

#使用端口1080

internal: eth0 port = 1080 

#使用对外网络接口   
external: eth0 

#使用的验证方式  
method: username none            （还未测试 要在后面加用户名还是不加，不加的话应该是试用系统用户）  
##user.privileged: root  
#user.notprivileged: sockd

#日志目录  
logoutput: /var/log/sockd.log       （touch一个sockd.log）

## client access rules

#client pass {  
#        from: 10.1.1.0/24 to: 0.0.0.0/0 #internal network  
#        log: connect disconnect  
#}

#允许所有的客户端连接

client pass {  
        from: 0.0.0.0/0 to:0.0.0.0/0  
        log: connect disconnect  
}

  
## server operation access rules

#allow bind to ports greater than 1023  
#pass {  
#        from: 0.0.0.0/0 to: 0.0.0.0/0 port gt 1023  
#        command: bind  
#        log: connect disconnect  
#}

#allow outgoing connections (tcp and udp)  
pass {  
        from: 0.0.0.0/0 to: 0.0.0.0/0  
        command: connect udpassociate  
        log: connect disconnect  
}

#允许所有UDP代理 和 DNS解析.

#allow replies to bind, and incoming udp packets  
pass {  
       from: 0.0.0.0/0 to: 0.0.0.0/0  
       command: bindreply udpreply  
       log: connect error  
}

#log the rest  
#block {  
#       from: 0.0.0.0/0 to: 0.0.0.0/0  
#       log: connect error

```